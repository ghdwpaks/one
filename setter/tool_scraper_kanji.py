k = ["解決","出発","年生","工事","契約","到着","抗議","意味","全体","制限","浸水","食事","番目","留学生","背景","電気自動車","昨年","市内","関与","変更","維持","変化","建設","歴史","広島","西日本","侵攻","入院","友達","鹿児島県","兵士","北部","注文","社会","文化","獲得","万人以上","行為","政治","農家","買収","土砂災害","感謝","被告","与党","被害者","製造","言葉","観光","記録的","検察","山火事","女王","西部","市長","国境","深刻","大変","閉鎖","国王","土地","改善","実験","俳優","全員","世界中","大人","遺族","中国政府","特定","派遣","日本語","部分","現金","年寄","経営","消費税","放送","容疑","回復","一致","列車","完全","刃物","事態","階建","料金","意識","無料","賛成","沖縄県","家庭","歳以上","活躍","反発","展示","野菜","事業","議席","夫婦","医者","北京","息子","今月日","追加","自転車","犯罪","中部","期間","立場","範囲","特徴","分野","人間","承認","混乱","受賞","大量","拠点","番組","連携","負傷","違法","通常","同社","安定","機能","不安","過去最高","悪化","利用者","廃止","父親","署名","否定的","太陽","検証","報道官","社員","少年","許可","倒壊","継続","会長","組織","自治体","手術","作業員","正式","近郊","国会","首脳会談","希望","日本製鉄","就任","王室","将来","患者","安心","時代","辞任","男女","墜落","高校","画像","高速道路","一度","終了","大勢","世代","貿易","練習","動物園","誕生日","一連","手続","知事","海岸","株価","手伝","乗用車","火山","存在","成立","追加関税","半分","続投","方向","双方","位置","富士山","選択肢","付近","部品","刑務所","石川県","最終的","都内","犠牲","勝利","取得","授業","捜査関係者","医師","手紙","開幕","公式","認定","値下","無事","消費者","相互関税","女子","否定","水準","警告","感染者","条件","徹底","当初","屋根","恐竜","高校生","人物","競争","最新","担当","申請","地下鉄","地方","圧力","詳細","世界的","登場","症状","熊本県","三振","参加者","年齢","日未明","沖縄","保護","土砂崩","負担","時点","期限","竜巻","取引","犯人","効果","突然","研究者","日本政府","地下","要求","野党","物価","何度","中東","毎日","規制","情勢","花火","同様","議会","候補者","中心部","主要","演説","予測","日目","打席","訓練","書類","成果","発射","障害","以降","配信","破壊","重体","教育","委員会","記者","難民","慎重","延長","空爆","達成","発展","不安定","犠牲者","供述","登録","年連続","文書","宣言","罰金","報道","対立","笑顔","話題","具合","外相","帰国","自然","不足","要請","小学生","収入","戦闘","同時","火星","宇宙船","逃走","早期","輸入品","先週","詐欺","友人","一人","政党","関税率","悪石島","菓子","向上","搭載","飲食店","報告書","大型","命令","大統領令","国営","若者","教会","長崎","都道府県","大気","前線","普通","対戦","表示","年代","所属","設定","地元当局","価値","東北","簡単","大統領選挙","福島県","低下","税率","京都","回収","努力","千葉県","年月","現時点","巨大","費用","観光地","把握","携帯電話","円安","月末","作成","売上高","人目","管理","新幹線","首脳","基準","季節","危険性","言及","想定","関東","大使館","利下","診断","記念","一日","化石","下回","月以降","延期","感染拡大","出演","売却","加速","規模","東海","被爆者","仲間","英語","直後","最高気温","中学校","停電","国籍","共有","鉄道","夕方","月間","体重","福岡県","下落","機会","制裁","万台","核施設","理事","試験","線状降水帯","適用","投手","警察庁","年以降","程度","解除","資金","段階","金利","進展","東京電力","減税","組織委員会","以外","謝罪","権利","急増","時間後","公明党","金額","強風","両親","全力","処分","候補","緩和","失敗","役所","式典","国際的","議長","集中","事実情報","広告","従来","一番","仕組","消火活動","航空","心臓","爆弾","赤字","残念","自殺","運用","以来","滞在","貢献","証拠","先発","業者","決勝","自衛隊","供給","事前","人生","見舞","重傷","彼女","土砂","博物館","困難","梅雨","歌手","救出","大学生","予算","前日","生成","避難所","交換","大阪府","表現","局地的","雇用","横浜市","担当者","番通報","高級","新聞","増水","投資家","連合","経緯","国民民主党","弁護士","路上","中国人","平方","今日","発動","人形","燃料","外務省","震源","消費","関西万博","相撲","倍以上","日以降","個人","氾濫","未来","前回","長官","不満","関心","上空","営業","距離","民主党","税込","世話","倉庫","依然","無人機","衆議院","経費","親会社","以前","領土","株式市場","急激","解放","原発","秋田県","年以上","上海","天皇陛下","場面","接種","計算","可決","農業","最高","高齢者","暴力","時前","終値","温度","証言"]
l = [

]

import re
import os

from selenium.webdriver.chrome.options import Options
from selenium.webdriver.chrome.service import Service
import subprocess
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

def remove_brackets(text):
    # 숫자와 점 다음에 오는 괄호를 처리하는 정규 표현식
    numbered_bracket_pattern = re.compile(r"\d+\.\s*\([^)]+\)")
    
    # 숫자와 점 다음에 오는 괄호를 일시적으로 보호하기 위한 플레이스홀더
    placeholders = {}
    
    # numbered_bracket_pattern에 해당하는 모든 부분을 찾아서 일시적으로 대체
    def protect_numbered_brackets(match):
        placeholder = f"PLACEHOLDER_{len(placeholders)}"
        placeholders[placeholder] = match.group(0)
        return placeholder
    
    # 보호할 괄호 부분 대체
    protected_text = numbered_bracket_pattern.sub(protect_numbered_brackets, text)
    
    # 보호하지 않은 일반 괄호 처리
    def replace(match):
        content = match.group(1)
        if re.fullmatch(r"[\uAC00-\uD7AF]{1,3}", content):
            return f"({content})"
        else:
            return ""

    result = re.sub(r"\(([^)]+)\)", replace, protected_text)
    
    # 보호했던 부분을 원래대로 복구
    for placeholder, original in placeholders.items():
        result = result.replace(placeholder, original)
    
    return result

def find_next_sentence(text, keyword, number=1):
    # 텍스트를 줄바꿈으로 분리하여 문장 리스트 생성
    sentences = text.split('\n')
    # 키워드가 포함된 문장을 찾고 다음 문장을 반환
    for i in range(len(sentences) - 1):
        if keyword in sentences[i]:
            return sentences[i + number]  # 다음 문장 반환
    return "키워드를 포함하는 문장이 없습니다."

 
from selenium import webdriver
from selenium.webdriver.common.by import By
import time
from bs4 import BeautifulSoup
from selenium.common.exceptions import TimeoutException

for kan in k :
    options = Options()
    options.add_argument('--headless')
    options.add_argument('--disable-gpu')
    options.add_argument('--log-level=3')  # 로그 레벨 최소화

    service = Service(log_output=subprocess.DEVNULL)  # 로그 숨김
    service = Service(log_output=subprocess.DEVNULL)
    os.environ['WDM_LOG'] = '0'
    driver = webdriver.Chrome(options=options, service=service)  # ChromeDriver 필요
    driver.get(f"https://ja.dict.naver.com/#/search?query={kan}&range=all")

    if len(kan) > 1 : 
        
        # 원하는 데이터 추출
        try : 
            elements = WebDriverWait(driver, 20).until(
                EC.presence_of_all_elements_located((By.CLASS_NAME, "has-saving-function"))
            )
        except TimeoutException :
            t = {"kan":kan,"sound":"","mean":""}
            print("ghdwpaks"*3,t)
            l.append(t)
            continue
        
        t = remove_brackets(elements[0].text)
        #한자, 발음, 뜻,
        end_keyword = "민중서림 엣센스 일한사전"
        t = t.split(end_keyword)[0]

        t_splited = t.split("\n")
        발음 = t_splited[0].split("[")[0].strip()
        
        
        뜻 = ""
        품사 = find_next_sentence(t, '단어장에 저장')
        뜻_부분 = find_next_sentence(t, '단어장에 저장', number=2)
        pattern = r'^\d+\.'
        print("*"*88)
        if re.match(pattern, 뜻_부분):
            뜻_부분 = ""
            #뜻이 여러개
            
            뜻_시작_줄 = 0 
            for i in range(len(t_splited) - 1):
                if '단어장에 저장' in t_splited[i]:
                    i = i + 1
                    break


            뜻 += f"[{t_splited[i]}] "#품사
            while True :
                i += 1
                if len(t_splited)-1 <= i   : break # -1 은 문단 뒤에 있는 '민중서림 엣센스 일한사전' 부분을 없애기 위해서이다.
                if re.match(pattern, t_splited[i]) : #숫자가 맞는지
                    뜻 += f"{t_splited[i]}".strip() # 숫자
                    i += 1
                    뜻 += f"{t_splited[i]}".strip().replace(".","")+" " # 의미
                else :
                    padding = ""
                    if not 뜻[-1] == " " :
                        padding = " "
                    #품사가 있다는 의미
                    뜻 += f"{padding}/ [{t_splited[i]}] "#품사
                    
                    continue #품사 기록하고 처음으로 돌아가기
                    
        else:
            #뜻이 한개
            뜻 = f"[{품사}] {뜻_부분}"

        print("발음 :",발음)
        print("뜻 :",뜻)
        t = {
            "kan":kan,
            "sound":발음,
            "mean":뜻.strip()
            }
        print("ghdwpaks"*3,t)
        l.append(t)


    
    else : 



        # 원하는 데이터 추출
        elements = driver.find_elements(By.CLASS_NAME, "addition_info")  # 클래스 이름을 변경해야 할 수 있음
        for element in elements:
            print("len(kan) :",len(kan))

            #단일글자라면
            t = {"k":kan,"s":"","m":"","p":""}

            # 줄 단위로 텍스트를 분리
            lines = element.text.strip().split("\n")

            # "음독"과 "훈독" 다음 줄의 내용을 추출하여 t 변수에 추가
            for i, line in enumerate(lines):
                if line == "음독" and i + 1 < len(lines):
                    t["s"] += lines[i + 1]  # 음독 다음 줄을 "s"에 추가
                elif line == "훈독" and i + 1 < len(lines):
                    t["m"] += lines[i + 1]  # 훈독 다음 줄을 "m"에 추가
                elif line == "부수" and i + 1 < len(lines):
                    t["p"] += lines[i + 1]  # 훈독 다음 줄을 "m"에 추가
            print(t)
            l.append(t)

    driver.quit()

print(l)



